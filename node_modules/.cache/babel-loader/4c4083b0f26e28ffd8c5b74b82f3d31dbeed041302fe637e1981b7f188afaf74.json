{"ast":null,"code":"import React,{useState,useEffect,useCallback,useRef}from\"react\";import axios from\"axios\";import{useNavigate}from\"react-router-dom\";import{Button,Dialog,DialogTitle,DialogContent,DialogActions}from\"@mui/material\";import Loadable from'react-loadable';import moment from'moment';import SUNavBar from\"../../components/SUNavBar\";import\"./SUHome.css\";import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const SUComment=Loadable({loader:()=>import('./SUComment'),loading:()=>/*#__PURE__*/_jsx(\"div\",{children:\"Loading...\"})});const SUHome=()=>{const navigate=useNavigate();const[isOverlayVisible,setOverlayVisible]=useState(false);const[newPostContent,setNewPostContent]=useState(\"\");const[posts,setPosts]=useState([]);const[selectedFile,setSelectedFile]=useState(null);const[imagePreview,setImagePreview]=useState(null);const[currentPostId,setCurrentPostId]=useState(null);const[currentPostOwner,setCurrentPostOwner]=useState(null);const[comments,setComments]=useState([]);const[isCommentDialogOpen,setIsCommentDialogOpen]=useState(false);const[loggedInSuperUser,setLoggedInSuperUser]=useState(null);const[newComment,setNewComment]=useState('');const[isDeletePostDialogOpen,setIsDeletePostDialogOpen]=useState(false);const[isDeleteCommentDialogOpen,setIsDeleteCommentDialogOpen]=useState(false);const[itemToDelete,setItemToDelete]=useState(null);const[profilePicture,setProfilePicture]=useState(null);const[superuserProfilePictures,setSuperUserProfilePictures]=useState({});const defaultProfile='/dp.png';const[inputHasContent,setInputHasContent]=useState(false);const[showCancelButton,setShowCancelButton]=useState(false);const[showCloseButton,setShowCloseButton]=useState(false);const fileInputRef=useRef(null);useEffect(()=>{console.log(\"Fetching Logged In SuperUser\");const fetchLoggedInSuperUser=async()=>{const storedSuperUser=JSON.parse(localStorage.getItem(\"loggedInSuperUser\"));console.log(\"Stored SuperUser:\",storedSuperUser);if(storedSuperUser&&storedSuperUser.superusername){try{const response=await axios.get(\"http://localhost:8080/superuser/getBySuperUsername?superusername=\".concat(storedSuperUser.superusername));setLoggedInSuperUser(response.data);console.log(\"Fetched superuser data:\",response.data);}catch(error){console.error(\"Error fetching superuser data:\",error);}}};fetchLoggedInSuperUser();},[]);const fetchSuperUserProfilePicture=useCallback(async superuserId=>{try{const response=await fetch(\"http://localhost:8080/superuser/profile/getProfilePicture/\".concat(superuserId));if(response.ok){const imageBlob=await response.blob();const imageUrl=URL.createObjectURL(imageBlob);setSuperUserProfilePictures(prev=>({...prev,[superuserId]:imageUrl}));}else{setSuperUserProfilePictures(prev=>({...prev,[superuserId]:defaultProfile}));}}catch(error){console.error('Failed to fetch superuser profile picture:',error);setSuperUserProfilePictures(prev=>({...prev,[superuserId]:defaultProfile}));}},[]);useEffect(()=>{const fetchPostsAndPictures=async()=>{try{const response=await axios.get(\"http://localhost:8080/posts\");console.log(\"Fetched posts data:\",response.data);const sortedPosts=response.data.sort((a,b)=>new Date(b.timestamp)-new Date(a.timestamp));setPosts(sortedPosts);const superuserIds=new Set(sortedPosts.map(post=>post.superuserId));superuserIds.forEach(superuserId=>fetchSuperUserProfilePicture(superuserId));}catch(error){console.error(\"Error fetching posts:\",error);}};fetchPostsAndPictures();},[fetchSuperUserProfilePicture]);useEffect(()=>{if(currentPostId){const fetchCommentsAndPictures=async()=>{try{const[commentsResponse,postResponse]=await Promise.all([axios.get(\"http://localhost:8080/comments/\".concat(currentPostId)),axios.get(\"http://localhost:8080/posts/\".concat(currentPostId))]);const sortedComments=commentsResponse.data.sort((a,b)=>new Date(b.timestamp)-new Date(a.timestamp)).map(comment=>({...comment,relativeTime:moment(comment.timestamp).fromNow()}));setComments(sortedComments);setCurrentPostOwner(postResponse.data.superuserId);const commentSuperUserIds=new Set(sortedComments.map(comment=>comment.superuserId));commentSuperUserIds.forEach(superuserId=>fetchSuperUserProfilePicture(superuserId));}catch(error){console.error(\"Error fetching comments or post details:\",error);}};fetchCommentsAndPictures();}},[currentPostId,fetchSuperUserProfilePicture]);const fetchLoggedInSuperUsers=useCallback(()=>{const superuser=JSON.parse(localStorage.getItem(\"loggedInSuperUser\"))||null;setLoggedInSuperUser(superuser);return superuser;},[]);const handlePostInputChange=e=>{const content=e.target.value;setNewPostContent(content);setShowCloseButton(content.length>0||imagePreview!==null);};const handleFileChange=event=>{const file=event.target.files[0];if(file){const reader=new FileReader();reader.onloadend=()=>{setImagePreview(reader.result);setShowCloseButton(true);};reader.readAsDataURL(file);}};const fetchProfilePicture=useCallback(async superuserId=>{try{const response=await fetch(\"http://localhost:8080/superuser/profile/getProfilePicture/\".concat(superuserId));if(response.ok){const imageBlob=await response.blob();if(imageBlob.size>0){const imageUrl=URL.createObjectURL(imageBlob);setProfilePicture(imageUrl);}else{setProfilePicture(defaultProfile);}}else{setProfilePicture(defaultProfile);}}catch(error){console.error('Failed to fetch profile picture:',error);setProfilePicture(defaultProfile);}},[defaultProfile]);useEffect(()=>{const superuser=fetchLoggedInSuperUsers();if(superuser){fetchProfilePicture(superuser.superuserId);}},[fetchLoggedInSuperUsers,fetchProfilePicture]);const handleMicClick=()=>{if(!(\"webkitSpeechRecognition\"in window))return;const recognition=new window.webkitSpeechRecognition();recognition.continuous=false;recognition.interimResults=false;recognition.lang=\"en-US\";recognition.onresult=event=>{const transcript=event.results[0][0].transcript;setNewPostContent(prevContent=>prevContent+\" \"+transcript);};recognition.onerror=event=>{console.log(\"Speech recognition error:\",event.error);};recognition.start();};const handlePostSubmit=async e=>{e.preventDefault();if(!newPostContent&&!imagePreview){alert(\"Please enter a post or select a picture before submitting.\");return;}console.log(\"Logged In SuperUser:\",loggedInSuperUser);if(!loggedInSuperUser||!loggedInSuperUser.superuserId){alert(\"Please log in to post.\");return;}// Log the post data before sending it\nconst newPost={content:newPostContent,image:imagePreview,superUserId:loggedInSuperUser.superuserId,// Ensure this is set\nfullName:loggedInSuperUser.fullName,idNumber:loggedInSuperUser.superuseridNumber,likes:0,dislikes:0};console.log(\"Post Data:\",newPost);// Log the data to be sent\ntry{const response=await axios.post(\"http://localhost:8080/posts/add\",newPost,{headers:{'Content-Type':'application/json'}});setPosts(prevPosts=>[response.data,...prevPosts]);setNewPostContent(\"\");setSelectedFile(null);setImagePreview(null);setShowCloseButton(false);}catch(error){console.error(\"Error posting data:\",error);if(error.response){console.error(\"Response data:\",error.response.data);console.error(\"Response status:\",error.response.status);}}};const handleLike=async postId=>{if(!loggedInSuperUser){alert(\"Please log in to like posts.\");return;}try{const response=await axios.post(\"http://localhost:8080/posts/\".concat(postId,\"/like\"),{},{params:{userId:loggedInSuperUser.superuserId,// Send superuser ID\nisAdmin:false// Indicates this is a superuser action\n}});const updatedPost=response.data;setPosts(posts.map(post=>post.postId===postId?updatedPost:post));}catch(error){console.error(\"Error liking post:\",error);}};const handleDislike=async postId=>{if(!loggedInSuperUser){alert(\"Please log in to dislike posts.\");return;}try{const response=await axios.post(\"http://localhost:8080/posts/\".concat(postId,\"/dislike\"),{},{params:{userId:loggedInSuperUser.superuserId,// Send superuser ID\nisAdmin:false// Indicates this is a superuser action\n}});const updatedPost=response.data;setPosts(posts.map(post=>post.postId===postId?updatedPost:post));}catch(error){console.error(\"Error disliking post:\",error);}};const handleOpenComments=async postId=>{setCurrentPostId(postId);try{const[commentsResponse,postResponse]=await Promise.all([axios.get(\"http://localhost:8080/comments/\".concat(postId)),axios.get(\"http://localhost:8080/posts/\".concat(postId))]);const sortedComments=commentsResponse.data.sort((a,b)=>new Date(b.timestamp)-new Date(a.timestamp)).map(comment=>({...comment,relativeTime:moment(comment.timestamp).fromNow()}));setComments(sortedComments);setCurrentPostOwner(postResponse.data.superuserId);}catch(error){console.error(\"Error fetching comments or post details:\",error);}setIsCommentDialogOpen(true);};const handleCloseComments=()=>{setIsCommentDialogOpen(false);setCurrentPostId(null);};const handleAddComment=async()=>{if(newComment.trim()==='')return;if(!loggedInSuperUser||!loggedInSuperUser.superuserId){alert(\"SuperUser must be logged in to comment.\");return;}const comment={content:newComment,postId:currentPostId,superUserId:loggedInSuperUser.superuserId,// Ensure this is set\nfullName:loggedInSuperUser.fullName,idNumber:loggedInSuperUser.idNumber,// Correct the id number field\ntimestamp:new Date().toISOString()// Ensure correct timestamp format\n};console.log(\"Comment Data:\",comment);// Log the comment data before sending it\ntry{const response=await axios.post('http://localhost:8080/comments/add',comment);const newCommentWithRelativeTime={...response.data,relativeTime:moment(response.data.timestamp).fromNow()};setComments(prevComments=>[newCommentWithRelativeTime,...prevComments]);setNewComment('');}catch(error){console.error(\"Error adding comment:\",error);if(error.response){console.error(\"Response data:\",error.response.data);console.error(\"Response status:\",error.response.status);}}};const handleDeletePost=postId=>{if(!loggedInSuperUser){alert(\"Please log in to delete posts.\");return;}setItemToDelete(postId);setIsDeletePostDialogOpen(true);};const handleDeleteComment=(commentId,commentSuperUserId)=>{if(!loggedInSuperUser){alert(\"Please log in to delete comments.\");return;}if(loggedInSuperUser.superuserId===commentSuperUserId||loggedInSuperUser.superuserId===currentPostOwner){setItemToDelete(commentId);setIsDeleteCommentDialogOpen(true);}else{alert(\"You don't have permission to delete this comment.\");}};const confirmDeletePost=async()=>{try{await axios.delete(\"http://localhost:8080/posts/\".concat(itemToDelete));setPosts(posts.filter(post=>post.postId!==itemToDelete));setIsDeletePostDialogOpen(false);}catch(error){console.error(\"Error deleting post:\",error);}};const confirmDeleteComment=async()=>{try{await axios.delete(\"http://localhost:8080/comments/\".concat(itemToDelete),{params:{superuserId:loggedInSuperUser.superuserId}});setComments(comments.filter(comment=>comment.commentId!==itemToDelete));setIsDeleteCommentDialogOpen(false);}catch(error){console.error(\"Error deleting comment:\",error);alert(\"Failed to delete comment. You may not have permission.\");}};const formatTimestamp=timestamp=>{const momentDate=moment(timestamp);return momentDate.format('dddd, MMMM D, YYYY [at] h:mm A');};const getRelativeTime=timestamp=>{return moment(timestamp).fromNow();};const handleClosePost=()=>{setNewPostContent('');setImagePreview(null);setShowCloseButton(false);if(fileInputRef.current){fileInputRef.current.value='';}};return/*#__PURE__*/_jsxs(\"div\",{className:\"adhome\",children:[/*#__PURE__*/_jsx(SUNavBar,{}),/*#__PURE__*/_jsx(\"b\",{className:\"HWildcat\",children:\"WILDCAT\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"content-wrapper\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"post-container\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"logo-container\",children:/*#__PURE__*/_jsx(\"img\",{src:profilePicture||defaultProfile,alt:\"SuperUser Avatar\",className:\"superusers-dp\"})}),/*#__PURE__*/_jsxs(\"div\",{className:\"post-form\",children:[/*#__PURE__*/_jsxs(\"form\",{onSubmit:handlePostSubmit,children:[/*#__PURE__*/_jsxs(\"div\",{className:\"input-container\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"text\",className:\"post-input\",value:newPostContent,onChange:handlePostInputChange,placeholder:\"What's happening in your day, Wildcat?\"}),showCloseButton&&/*#__PURE__*/_jsx(\"button\",{type:\"button\",className:\"close-button\",onClick:handleClosePost,children:\"\\xD7\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"post-subcontainer\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"post-subcontainer-icons\",children:[/*#__PURE__*/_jsx(\"label\",{htmlFor:\"file-upload\",children:/*#__PURE__*/_jsx(\"img\",{className:\"gallery-icon\",alt:\"\",src:\"/gallery.png\"})}),/*#__PURE__*/_jsx(\"input\",{ref:fileInputRef,id:\"file-upload\",type:\"file\",className:\"file-input\",style:{display:\"none\"},onChange:handleFileChange,onClick:e=>{e.target.value=null;}}),/*#__PURE__*/_jsx(\"img\",{className:\"mic-icon\",alt:\"Mic\",src:\"/mic.png\",onClick:handleMicClick,style:{cursor:\"pointer\"}})]}),/*#__PURE__*/_jsx(Button,{type:\"submit\",className:\"post-button\",variant:\"contained\",sx:{borderRadius:\"10px\",width:60,height:30,backgroundColor:\"#8A252C\",\"&:hover\":{backgroundColor:\"#A91D3A\"}},children:\"POST\"})]})]}),imagePreview&&/*#__PURE__*/_jsx(\"div\",{className:\"image-preview\",children:/*#__PURE__*/_jsx(\"img\",{src:imagePreview,alt:\"Preview\",style:{width:'100px',height:'100px'}})})]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"post-list\",children:posts.map(post=>/*#__PURE__*/_jsx(\"div\",{className:\"post-card\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"card-container\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"name-container\",children:[/*#__PURE__*/_jsx(\"img\",{src:superuserProfilePictures[post.superuserId]||defaultProfile,alt:\"SuperUser Avatar\"}),/*#__PURE__*/_jsxs(\"h5\",{children:[post.fullName,\" (\",post.superuseridNumber,\")\"]}),loggedInSuperUser&&loggedInSuperUser.superuserId===post.superuserId&&/*#__PURE__*/_jsx(\"img\",{src:\"/delete.png\",alt:\"Delete\",className:\"delete-icon\",onClick:()=>handleDeletePost(post.postId),style:{cursor:'pointer',width:'20px',height:'20px',marginLeft:'auto'}})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"timestamp\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"formatted-date\",children:formatTimestamp(post.timestamp)}),/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(\"span\",{className:\"relative-time\",children:getRelativeTime(post.timestamp)})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"card-contents\",children:[/*#__PURE__*/_jsx(\"p\",{children:post.content}),post.image&&/*#__PURE__*/_jsx(\"img\",{className:\"post-image\",alt:\"Post\",src:post.image,style:{maxWidth:'100%',height:'auto'}})]}),/*#__PURE__*/_jsx(\"div\",{className:\"footer-line\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"footer-actions\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"footer-icons\",children:[/*#__PURE__*/_jsxs(\"button\",{onClick:()=>handleLike(post.postId),className:\"like-button \".concat(post.likedBy&&post.likedBy.includes(loggedInSuperUser===null||loggedInSuperUser===void 0?void 0:loggedInSuperUser.superuserId)?'active':''),children:[/*#__PURE__*/_jsx(\"img\",{src:\"/t-up.png\",alt:\"Thumbs Up\"}),\" \",post.likes]}),/*#__PURE__*/_jsxs(\"button\",{onClick:()=>handleDislike(post.postId),className:\"dislike-button \".concat(post.dislikedBy&&post.dislikedBy.includes(loggedInSuperUser===null||loggedInSuperUser===void 0?void 0:loggedInSuperUser.superuserId)?'active':''),children:[/*#__PURE__*/_jsx(\"img\",{src:\"/t-down.png\",alt:\"Thumbs Down\"}),\" \",post.dislikes]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"footer-comments\",children:/*#__PURE__*/_jsx(\"button\",{className:\"comment-button\",onClick:()=>handleOpenComments(post.postId),children:\"Comment\"})})]})]})},post.postId))})]}),/*#__PURE__*/_jsxs(Dialog,{open:isCommentDialogOpen,onClose:handleCloseComments,children:[/*#__PURE__*/_jsxs(DialogTitle,{children:[\"Comments\",/*#__PURE__*/_jsx(\"img\",{src:\"/exit.png\",alt:\"Close\",className:\"exit-icon\",onClick:handleCloseComments})]}),/*#__PURE__*/_jsx(DialogContent,{children:comments.map(comment=>/*#__PURE__*/_jsxs(\"div\",{className:\"comment\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"comment-header\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"superuser-info-container\",children:[/*#__PURE__*/_jsxs(\"span\",{className:\"superuser-info\",children:[comment.fullName,\" (\",comment.superuseridNumber,\")\"]}),loggedInSuperUser&&(loggedInSuperUser.superuserId===comment.superuserId||loggedInSuperUser.superuserId===currentPostOwner)&&/*#__PURE__*/_jsx(\"img\",{src:\"/delete.png\",alt:\"Delete\",className:\"delete-icon\",onClick:()=>handleDeleteComment(comment.commentId,comment.superuserId)})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"timestamp-container\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"formatted-time\",children:formatTimestamp(comment.timestamp)}),/*#__PURE__*/_jsx(\"span\",{className:\"relative-time\",children:comment.relativeTime})]})]}),/*#__PURE__*/_jsx(\"p\",{children:comment.content})]},comment.commentId))}),/*#__PURE__*/_jsx(DialogActions,{children:/*#__PURE__*/_jsxs(\"div\",{className:\"add-comment\",style:{display:'flex',width:'100%',padding:'10px'},children:[/*#__PURE__*/_jsx(\"input\",{type:\"text\",value:newComment,onChange:e=>setNewComment(e.target.value),placeholder:\"Add a comment...\",style:{flexGrow:1,marginRight:'10px',padding:'8px',border:'1px solid #ccc',borderRadius:'4px'}}),/*#__PURE__*/_jsx(Button,{onClick:handleAddComment,variant:\"contained\",sx:{backgroundColor:'#8A252C',color:'white','&:hover':{backgroundColor:'#f9d67b',color:'black'},transition:'all 0.3s ease'},children:\"Comment\"})]})})]}),/*#__PURE__*/_jsxs(Dialog,{open:isDeletePostDialogOpen,onClose:()=>setIsDeletePostDialogOpen(false),children:[/*#__PURE__*/_jsx(DialogTitle,{children:\"Confirm Delete\"}),/*#__PURE__*/_jsx(DialogContent,{children:\"Are you sure you want to delete this post?\"}),/*#__PURE__*/_jsxs(DialogActions,{className:\"delete-dialog-actions\",children:[/*#__PURE__*/_jsx(Button,{onClick:()=>setIsDeletePostDialogOpen(false),className:\"cancel-button\",children:\"Cancel\"}),/*#__PURE__*/_jsx(Button,{onClick:confirmDeletePost,className:\"delete-button\",children:\"Delete\"})]})]}),/*#__PURE__*/_jsxs(Dialog,{open:isDeleteCommentDialogOpen,onClose:()=>setIsDeleteCommentDialogOpen(false),children:[/*#__PURE__*/_jsx(DialogTitle,{children:\"Confirm Delete\"}),/*#__PURE__*/_jsx(DialogContent,{children:\"Are you sure you want to delete this comment?\"}),/*#__PURE__*/_jsxs(DialogActions,{className:\"delete-dialog-actions\",children:[/*#__PURE__*/_jsx(Button,{onClick:()=>setIsDeleteCommentDialogOpen(false),className:\"cancel-button\",children:\"Cancel\"}),/*#__PURE__*/_jsx(Button,{onClick:confirmDeleteComment,className:\"delete-button\",children:\"Delete\"})]})]})]});};export default SUHome;","map":{"version":3,"names":["React","useState","useEffect","useCallback","useRef","axios","useNavigate","Button","Dialog","DialogTitle","DialogContent","DialogActions","Loadable","moment","SUNavBar","jsx","_jsx","jsxs","_jsxs","SUComment","loader","loading","children","SUHome","navigate","isOverlayVisible","setOverlayVisible","newPostContent","setNewPostContent","posts","setPosts","selectedFile","setSelectedFile","imagePreview","setImagePreview","currentPostId","setCurrentPostId","currentPostOwner","setCurrentPostOwner","comments","setComments","isCommentDialogOpen","setIsCommentDialogOpen","loggedInSuperUser","setLoggedInSuperUser","newComment","setNewComment","isDeletePostDialogOpen","setIsDeletePostDialogOpen","isDeleteCommentDialogOpen","setIsDeleteCommentDialogOpen","itemToDelete","setItemToDelete","profilePicture","setProfilePicture","superuserProfilePictures","setSuperUserProfilePictures","defaultProfile","inputHasContent","setInputHasContent","showCancelButton","setShowCancelButton","showCloseButton","setShowCloseButton","fileInputRef","console","log","fetchLoggedInSuperUser","storedSuperUser","JSON","parse","localStorage","getItem","superusername","response","get","concat","data","error","fetchSuperUserProfilePicture","superuserId","fetch","ok","imageBlob","blob","imageUrl","URL","createObjectURL","prev","fetchPostsAndPictures","sortedPosts","sort","a","b","Date","timestamp","superuserIds","Set","map","post","forEach","fetchCommentsAndPictures","commentsResponse","postResponse","Promise","all","sortedComments","comment","relativeTime","fromNow","commentSuperUserIds","fetchLoggedInSuperUsers","superuser","handlePostInputChange","e","content","target","value","length","handleFileChange","event","file","files","reader","FileReader","onloadend","result","readAsDataURL","fetchProfilePicture","size","handleMicClick","window","recognition","webkitSpeechRecognition","continuous","interimResults","lang","onresult","transcript","results","prevContent","onerror","start","handlePostSubmit","preventDefault","alert","newPost","image","superUserId","fullName","idNumber","superuseridNumber","likes","dislikes","headers","prevPosts","status","handleLike","postId","params","userId","isAdmin","updatedPost","handleDislike","handleOpenComments","handleCloseComments","handleAddComment","trim","toISOString","newCommentWithRelativeTime","prevComments","handleDeletePost","handleDeleteComment","commentId","commentSuperUserId","confirmDeletePost","delete","filter","confirmDeleteComment","formatTimestamp","momentDate","format","getRelativeTime","handleClosePost","current","className","src","alt","onSubmit","type","onChange","placeholder","onClick","htmlFor","ref","id","style","display","cursor","variant","sx","borderRadius","width","height","backgroundColor","marginLeft","maxWidth","likedBy","includes","dislikedBy","open","onClose","padding","flexGrow","marginRight","border","color","transition"],"sources":["/Users/richardmolina/Documents/GitHub/ADMIN_TECHHIVE_FRONTEND/src/SuperUser pages/SUHome/SUHome.js"],"sourcesContent":["import React, { useState, useEffect, useCallback, useRef } from \"react\";\nimport axios from \"axios\";\nimport { useNavigate } from \"react-router-dom\";\nimport { Button, Dialog, DialogTitle, DialogContent, DialogActions } from \"@mui/material\";\nimport Loadable from 'react-loadable';\nimport moment from 'moment';\nimport SUNavBar from \"../../components/SUNavBar\";\nimport \"./SUHome.css\";\n\nconst SUComment = Loadable({\n    loader: () => import('./SUComment'),\n    loading: () => <div>Loading...</div>,\n});\n\nconst SUHome = () => {\n    const navigate = useNavigate();\n    const [isOverlayVisible, setOverlayVisible] = useState(false);\n    const [newPostContent, setNewPostContent] = useState(\"\");\n    const [posts, setPosts] = useState([]);\n    const [selectedFile, setSelectedFile] = useState(null);\n    const [imagePreview, setImagePreview] = useState(null);\n    const [currentPostId, setCurrentPostId] = useState(null);\n    const [currentPostOwner, setCurrentPostOwner] = useState(null);\n    const [comments, setComments] = useState([]);\n    const [isCommentDialogOpen, setIsCommentDialogOpen] = useState(false);\n    const [loggedInSuperUser, setLoggedInSuperUser] = useState(null);\n    const [newComment, setNewComment] = useState('');\n    const [isDeletePostDialogOpen, setIsDeletePostDialogOpen] = useState(false);\n    const [isDeleteCommentDialogOpen, setIsDeleteCommentDialogOpen] = useState(false);\n    const [itemToDelete, setItemToDelete] = useState(null);\n    const [profilePicture, setProfilePicture] = useState(null);\n    const [superuserProfilePictures, setSuperUserProfilePictures] = useState({});\n    const defaultProfile = '/dp.png';\n    const [inputHasContent, setInputHasContent] = useState(false);\n    const [showCancelButton, setShowCancelButton] = useState(false);\n    const [showCloseButton, setShowCloseButton] = useState(false);\n\n    const fileInputRef = useRef(null);\n\n    useEffect(() => {\n        console.log(\"Fetching Logged In SuperUser\");\n        const fetchLoggedInSuperUser = async () => {\n            const storedSuperUser = JSON.parse(localStorage.getItem(\"loggedInSuperUser\"));\n            console.log(\"Stored SuperUser:\", storedSuperUser);\n            \n            if (storedSuperUser && storedSuperUser.superusername) {\n                try {\n                    const response = await axios.get(`http://localhost:8080/superuser/getBySuperUsername?superusername=${storedSuperUser.superusername}`);\n                    setLoggedInSuperUser(response.data);\n                    console.log(\"Fetched superuser data:\", response.data);\n                } catch (error) {\n                    console.error(\"Error fetching superuser data:\", error);\n                }\n            }\n        };\n        fetchLoggedInSuperUser();    \n    }, []);\n  \n\n    const fetchSuperUserProfilePicture = useCallback(async (superuserId) => {\n      try {\n          const response = await fetch(`http://localhost:8080/superuser/profile/getProfilePicture/${superuserId}`);\n          if (response.ok) {\n              const imageBlob = await response.blob();\n              const imageUrl = URL.createObjectURL(imageBlob);\n              setSuperUserProfilePictures(prev => ({ ...prev, [superuserId]: imageUrl }));\n          } else {\n              setSuperUserProfilePictures(prev => ({ ...prev, [superuserId]: defaultProfile }));\n          }\n      } catch (error) {\n          console.error('Failed to fetch superuser profile picture:', error);\n          setSuperUserProfilePictures(prev => ({ ...prev, [superuserId]: defaultProfile }));\n      }\n  }, []);\n\n  useEffect(() => {\n    const fetchPostsAndPictures = async () => {\n        try {\n            const response = await axios.get(\"http://localhost:8080/posts\");\n            console.log(\"Fetched posts data:\", response.data);\n            const sortedPosts = response.data.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));\n            setPosts(sortedPosts);\n\n            const superuserIds = new Set(sortedPosts.map(post => post.superuserId));\n            superuserIds.forEach(superuserId => fetchSuperUserProfilePicture(superuserId));\n        } catch (error) {\n            console.error(\"Error fetching posts:\", error);\n        }\n    };\n    fetchPostsAndPictures();\n}, [fetchSuperUserProfilePicture]);\n\n    useEffect(() => {\n        if (currentPostId) {\n            const fetchCommentsAndPictures = async () => {\n                try {\n                    const [commentsResponse, postResponse] = await Promise.all([\n                        axios.get(`http://localhost:8080/comments/${currentPostId}`),\n                        axios.get(`http://localhost:8080/posts/${currentPostId}`)\n                    ]);\n                    const sortedComments = commentsResponse.data\n                        .sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp))\n                        .map(comment => ({\n                            ...comment,\n                            relativeTime: moment(comment.timestamp).fromNow()\n                        }));\n                    setComments(sortedComments);\n                    setCurrentPostOwner(postResponse.data.superuserId);\n\n                    const commentSuperUserIds = new Set(sortedComments.map(comment => comment.superuserId));\n                    commentSuperUserIds.forEach(superuserId => fetchSuperUserProfilePicture(superuserId));\n                } catch (error) {\n                    console.error(\"Error fetching comments or post details:\", error);\n                }\n            };\n            fetchCommentsAndPictures();\n        }\n    }, [currentPostId, fetchSuperUserProfilePicture]);\n\n    const fetchLoggedInSuperUsers = useCallback(() => {\n        const superuser = JSON.parse(localStorage.getItem(\"loggedInSuperUser\")) || null;\n        setLoggedInSuperUser(superuser);\n        return superuser;\n    }, []);\n\n    const handlePostInputChange = (e) => {\n      const content = e.target.value;\n      setNewPostContent(content);\n      setShowCloseButton(content.length > 0 || imagePreview !== null);\n  };\n\n  const handleFileChange = (event) => {\n      const file = event.target.files[0];\n      if (file) {\n          const reader = new FileReader();\n          reader.onloadend = () => {\n              setImagePreview(reader.result);\n              setShowCloseButton(true);\n          };\n          reader.readAsDataURL(file);\n      }\n  };\n\n    const fetchProfilePicture = useCallback(async (superuserId) => {\n        try {\n            const response = await fetch(`http://localhost:8080/superuser/profile/getProfilePicture/${superuserId}`);\n            if (response.ok) {\n                const imageBlob = await response.blob();\n                if (imageBlob.size > 0) {\n                    const imageUrl = URL.createObjectURL(imageBlob);\n                    setProfilePicture(imageUrl);\n                } else {\n                    setProfilePicture(defaultProfile);\n                }\n            } else {\n                setProfilePicture(defaultProfile);\n            }\n        } catch (error) {\n            console.error('Failed to fetch profile picture:', error);\n            setProfilePicture(defaultProfile);\n        }\n    }, [defaultProfile]);\n\n    useEffect(() => {\n        const superuser = fetchLoggedInSuperUsers();\n        if (superuser) {\n            fetchProfilePicture(superuser.superuserId);\n        }\n    }, [fetchLoggedInSuperUsers, fetchProfilePicture]);\n\n    const handleMicClick = () => {\n        if (!(\"webkitSpeechRecognition\" in window)) return;\n        const recognition = new window.webkitSpeechRecognition();\n        recognition.continuous = false;\n        recognition.interimResults = false;\n        recognition.lang = \"en-US\";\n        recognition.onresult = (event) => {\n            const transcript = event.results[0][0].transcript;\n            setNewPostContent((prevContent) => prevContent + \" \" + transcript);\n        };\n        recognition.onerror = (event) => {\n            console.log(\"Speech recognition error:\", event.error);\n        };\n        recognition.start();\n    };\n\n    const handlePostSubmit = async (e) => {\n      e.preventDefault();\n      \n      if (!newPostContent && !imagePreview) {\n          alert(\"Please enter a post or select a picture before submitting.\");\n          return;\n      }\n    \n      console.log(\"Logged In SuperUser:\", loggedInSuperUser);\n    \n      if (!loggedInSuperUser || !loggedInSuperUser.superuserId) {\n          alert(\"Please log in to post.\");\n          return;\n      }\n    \n      // Log the post data before sending it\n      const newPost = {\n          content: newPostContent,\n          image: imagePreview,\n          superUserId: loggedInSuperUser.superuserId, // Ensure this is set\n          fullName: loggedInSuperUser.fullName,\n          idNumber: loggedInSuperUser.superuseridNumber,\n          likes: 0,\n          dislikes: 0,\n      };\n    \n      console.log(\"Post Data:\", newPost); // Log the data to be sent\n  \n      try {\n        const response = await axios.post(\"http://localhost:8080/posts/add\", newPost, {\n            headers: {\n                'Content-Type': 'application/json'\n            }\n        });\n  \n        setPosts(prevPosts => [response.data, ...prevPosts]);\n        setNewPostContent(\"\");\n        setSelectedFile(null);\n        setImagePreview(null);\n        setShowCloseButton(false);\n    } catch (error) {\n        console.error(\"Error posting data:\", error);\n        if (error.response) {\n            console.error(\"Response data:\", error.response.data);\n            console.error(\"Response status:\", error.response.status);\n        }\n    }\n  };\n  \n    const handleLike = async (postId) => {\n        if (!loggedInSuperUser) {\n            alert(\"Please log in to like posts.\");\n            return;\n        }\n        try {\n            const response = await axios.post(`http://localhost:8080/posts/${postId}/like`, {}, {\n                params: {\n                    userId: loggedInSuperUser.superuserId, // Send superuser ID\n                    isAdmin: false // Indicates this is a superuser action\n                }\n            });\n            const updatedPost = response.data;\n            setPosts(posts.map(post =>\n                post.postId === postId ? updatedPost : post\n            ));\n        } catch (error) {\n            console.error(\"Error liking post:\", error);\n        }\n    };\n\n    const handleDislike = async (postId) => {\n        if (!loggedInSuperUser) {\n            alert(\"Please log in to dislike posts.\");\n            return;\n        }\n        try {\n            const response = await axios.post(`http://localhost:8080/posts/${postId}/dislike`, {}, {\n                params: {\n                    userId: loggedInSuperUser.superuserId, // Send superuser ID\n                    isAdmin: false // Indicates this is a superuser action\n                }\n            });\n            const updatedPost = response.data;\n            setPosts(posts.map(post =>\n                post.postId === postId ? updatedPost : post\n            ));\n        } catch (error) {\n            console.error(\"Error disliking post:\", error);\n        }\n    };\n\n    const handleOpenComments = async (postId) => {\n      setCurrentPostId(postId);\n      try {\n          const [commentsResponse, postResponse] = await Promise.all([\n              axios.get(`http://localhost:8080/comments/${postId}`),\n              axios.get(`http://localhost:8080/posts/${postId}`)\n          ]);\n          const sortedComments = commentsResponse.data\n              .sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp))\n              .map(comment => ({\n                  ...comment,\n                  relativeTime: moment(comment.timestamp).fromNow()\n              }));\n          setComments(sortedComments);\n          setCurrentPostOwner(postResponse.data.superuserId);\n      } catch (error) {\n          console.error(\"Error fetching comments or post details:\", error);\n      }\n      setIsCommentDialogOpen(true);\n  };\n\n  const handleCloseComments = () => {\n    setIsCommentDialogOpen(false);\n    setCurrentPostId(null);\n};\n\nconst handleAddComment = async () => {\n    if (newComment.trim() === '') return;\n\n    if (!loggedInSuperUser || !loggedInSuperUser.superuserId) {\n        alert(\"SuperUser must be logged in to comment.\");\n        return;\n    }\n\n    const comment = {\n        content: newComment,\n        postId: currentPostId,\n        superUserId: loggedInSuperUser.superuserId,  // Ensure this is set\n        fullName: loggedInSuperUser.fullName,\n        idNumber: loggedInSuperUser.idNumber,  // Correct the id number field\n        timestamp: new Date().toISOString()  // Ensure correct timestamp format\n    };\n\n    console.log(\"Comment Data:\", comment);  // Log the comment data before sending it\n\n    try {\n        const response = await axios.post('http://localhost:8080/comments/add', comment);\n        const newCommentWithRelativeTime = {\n            ...response.data,\n            relativeTime: moment(response.data.timestamp).fromNow()\n        };\n        setComments(prevComments => [newCommentWithRelativeTime, ...prevComments]);\n        setNewComment('');\n    } catch (error) {\n        console.error(\"Error adding comment:\", error);\n        if (error.response) {\n            console.error(\"Response data:\", error.response.data);\n            console.error(\"Response status:\", error.response.status);\n        }\n    }\n};\n\n\n\n    const handleDeletePost = (postId) => {\n        if (!loggedInSuperUser) {\n            alert(\"Please log in to delete posts.\");\n            return;\n        }\n        setItemToDelete(postId);\n        setIsDeletePostDialogOpen(true);\n    };\n\n    const handleDeleteComment = (commentId, commentSuperUserId) => {\n        if (!loggedInSuperUser) {\n            alert(\"Please log in to delete comments.\");\n            return;\n        }\n        if (loggedInSuperUser.superuserId === commentSuperUserId || loggedInSuperUser.superuserId === currentPostOwner) {\n            setItemToDelete(commentId);\n            setIsDeleteCommentDialogOpen(true);\n        } else {\n            alert(\"You don't have permission to delete this comment.\");\n        }\n    };\n\n    const confirmDeletePost = async () => {\n        try {\n            await axios.delete(`http://localhost:8080/posts/${itemToDelete}`);\n            setPosts(posts.filter(post => post.postId !== itemToDelete));\n            setIsDeletePostDialogOpen(false);\n        } catch (error) {\n            console.error(\"Error deleting post:\", error);\n        }\n    };\n\n    const confirmDeleteComment = async () => {\n        try {\n            await axios.delete(`http://localhost:8080/comments/${itemToDelete}`, {\n                params: {\n                    superuserId: loggedInSuperUser.superuserId\n                }\n            });\n            setComments(comments.filter(comment => comment.commentId !== itemToDelete));\n            setIsDeleteCommentDialogOpen(false);\n        } catch (error) {\n            console.error(\"Error deleting comment:\", error);\n            alert(\"Failed to delete comment. You may not have permission.\");\n        }\n    };\n\n    const formatTimestamp = (timestamp) => {\n        const momentDate = moment(timestamp);\n        return momentDate.format('dddd, MMMM D, YYYY [at] h:mm A');\n    };\n\n    const getRelativeTime = (timestamp) => {\n        return moment(timestamp).fromNow();\n    };\n\n    const handleClosePost = () => {\n        setNewPostContent('');\n        setImagePreview(null);\n        setShowCloseButton(false);\n        if (fileInputRef.current) {\n            fileInputRef.current.value = '';\n        }\n    };\n\n    return (\n        <div className=\"adhome\">\n            <SUNavBar />  \n            <b className=\"HWildcat\">WILDCAT</b>\n\n            <div className=\"content-wrapper\">\n                <div className=\"post-container\">\n                    <div className=\"logo-container\">\n                        <img src={profilePicture || defaultProfile} alt=\"SuperUser Avatar\" className=\"superusers-dp\" />\n                    </div>\n                    <div className=\"post-form\">\n                        <form onSubmit={handlePostSubmit}>\n                            <div className=\"input-container\">\n                                <input\n                                    type=\"text\"\n                                    className=\"post-input\"\n                                    value={newPostContent}\n                                    onChange={handlePostInputChange}\n                                    placeholder=\"What's happening in your day, Wildcat?\"\n                                />\n                                {showCloseButton && (\n                                    <button type=\"button\" className=\"close-button\" onClick={handleClosePost}>\n                                        ×\n                                    </button>\n                                )}\n                            </div>\n                            <div className=\"post-subcontainer\">\n                                <div className=\"post-subcontainer-icons\">\n                                    <label htmlFor=\"file-upload\">\n                                        <img className=\"gallery-icon\" alt=\"\" src=\"/gallery.png\" />\n                                    </label>\n                                    <input\n                                        ref={fileInputRef}\n                                        id=\"file-upload\"\n                                        type=\"file\"\n                                        className=\"file-input\"\n                                        style={{ display: \"none\" }}\n                                        onChange={handleFileChange}\n                                        onClick={(e) => { e.target.value = null }}\n                                    />\n                                    <img\n                                        className=\"mic-icon\"\n                                        alt=\"Mic\"\n                                        src=\"/mic.png\"\n                                        onClick={handleMicClick}\n                                        style={{ cursor: \"pointer\" }}\n                                    />\n                                </div>\n                                <Button\n                                    type=\"submit\"\n                                    className=\"post-button\"\n                                    variant=\"contained\"\n                                    sx={{\n                                        borderRadius: \"10px\",\n                                        width: 60,\n                                        height: 30,\n                                        backgroundColor: \"#8A252C\",\n                                        \"&:hover\": { backgroundColor: \"#A91D3A\" }\n                                    }}\n                                >\n                                    POST\n                                </Button>\n                            </div>\n                        </form>\n                        {imagePreview && (\n                            <div className=\"image-preview\">\n                                <img src={imagePreview} alt=\"Preview\" style={{ width: '100px', height: '100px' }} />\n                            </div>\n                        )}\n                    </div>\n                </div>\n                <div className=\"post-list\">\n                    {posts.map((post) => (\n                        <div key={post.postId} className=\"post-card\">\n                            <div className=\"card-container\">\n                                <div className=\"name-container\">\n                                    <img src={superuserProfilePictures[post.superuserId] || defaultProfile} alt=\"SuperUser Avatar\" />\n                                    <h5>{post.fullName} ({post.superuseridNumber})</h5>\n                                    {loggedInSuperUser && loggedInSuperUser.superuserId === post.superuserId && (\n                                        <img\n                                            src=\"/delete.png\"\n                                            alt=\"Delete\"\n                                            className=\"delete-icon\"\n                                            onClick={() => handleDeletePost(post.postId)}\n                                            style={{ cursor: 'pointer', width: '20px', height: '20px', marginLeft: 'auto' }}\n                                        />\n                                    )}\n                                </div>\n                                <div className=\"timestamp\">\n                                    <span className=\"formatted-date\">{formatTimestamp(post.timestamp)}</span>\n                                    <br />\n                                    <span className=\"relative-time\">{getRelativeTime(post.timestamp)}</span>\n                                </div>\n                                <div className=\"card-contents\">\n                                    <p>{post.content}</p>\n                                    {post.image && (\n                                        <img\n                                            className=\"post-image\"\n                                            alt=\"Post\"\n                                            src={post.image}\n                                            style={{ maxWidth: '100%', height: 'auto' }}\n                                        />\n                                    )}\n                                </div>\n                                <div className=\"footer-line\" />\n                                <div className=\"footer-actions\">\n                                    <div className=\"footer-icons\">\n                                        <button \n                                            onClick={() => handleLike(post.postId)} \n                                            className={`like-button ${post.likedBy && post.likedBy.includes(loggedInSuperUser?.superuserId) ? 'active' : ''}`}\n                                        >\n                                            <img src=\"/t-up.png\" alt=\"Thumbs Up\" /> {post.likes}\n                                        </button>\n                                        <button \n                                            onClick={() => handleDislike(post.postId)} \n                                            className={`dislike-button ${post.dislikedBy && post.dislikedBy.includes(loggedInSuperUser?.superuserId) ? 'active' : ''}`}\n                                        >\n                                            <img src=\"/t-down.png\" alt=\"Thumbs Down\" /> {post.dislikes}\n                                        </button>\n                                    </div>\n                                    <div className=\"footer-comments\">\n                                        <button className=\"comment-button\" onClick={() => handleOpenComments(post.postId)}>Comment</button>\n                                    </div>\n                                </div>\n                            </div>\n                        </div>\n                    ))}\n                </div>\n            </div>\n\n            <Dialog open={isCommentDialogOpen} onClose={handleCloseComments}>\n                <DialogTitle>\n                    Comments\n                    <img\n                        src=\"/exit.png\"\n                        alt=\"Close\"\n                        className=\"exit-icon\"\n                        onClick={handleCloseComments}\n                    />\n                </DialogTitle>\n                <DialogContent>\n                    {comments.map((comment) => (\n                        <div key={comment.commentId} className=\"comment\">\n                            <div className=\"comment-header\">\n                                <div className=\"superuser-info-container\">\n                                    <span className=\"superuser-info\">\n                                        {comment.fullName} ({comment.superuseridNumber})\n                                    </span>\n                                    {(loggedInSuperUser && (loggedInSuperUser.superuserId === comment.superuserId || loggedInSuperUser.superuserId === currentPostOwner)) && (\n                                        <img\n                                            src=\"/delete.png\"\n                                            alt=\"Delete\"\n                                            className=\"delete-icon\"\n                                            onClick={() => handleDeleteComment(comment.commentId, comment.superuserId)}\n                                        />\n                                    )}\n                                </div>\n                                <div className=\"timestamp-container\">\n                                    <span className=\"formatted-time\">\n                                        {formatTimestamp(comment.timestamp)}\n                                    </span>\n                                    <span className=\"relative-time\">\n                                        {comment.relativeTime}\n                                    </span>\n                                </div>\n                            </div>\n                            <p>{comment.content}</p>\n                        </div>\n                    ))}\n                </DialogContent>\n                <DialogActions>\n                    <div className=\"add-comment\" style={{ display: 'flex', width: '100%', padding: '10px' }}>\n                        <input\n                            type=\"text\"\n                            value={newComment}\n                            onChange={(e) => setNewComment(e.target.value)}\n                            placeholder=\"Add a comment...\"\n                            style={{ \n                                flexGrow: 1, \n                                marginRight: '10px', \n                                padding: '8px', \n                                border: '1px solid #ccc', \n                                borderRadius: '4px' \n                            }}\n                        />\n                        <Button \n                            onClick={handleAddComment}\n                            variant=\"contained\"\n                            sx={{ \n                                backgroundColor: '#8A252C', \n                                color: 'white',\n                                '&:hover': {\n                                    backgroundColor: '#f9d67b',\n                                    color: 'black'\n                                },\n                                transition: 'all 0.3s ease'\n                            }}\n                        >\n                            Comment\n                        </Button>\n                    </div>\n                </DialogActions>\n            </Dialog>\n\n            <Dialog open={isDeletePostDialogOpen} onClose={() => setIsDeletePostDialogOpen(false)}>\n                <DialogTitle>Confirm Delete</DialogTitle>\n                <DialogContent>\n                    Are you sure you want to delete this post?\n                </DialogContent>\n                <DialogActions className=\"delete-dialog-actions\">\n                    <Button onClick={() => setIsDeletePostDialogOpen(false)} className=\"cancel-button\">Cancel</Button>\n                    <Button onClick={confirmDeletePost} className=\"delete-button\">Delete</Button>\n                </DialogActions>\n            </Dialog>\n\n            <Dialog open={isDeleteCommentDialogOpen} onClose={() => setIsDeleteCommentDialogOpen(false)}>\n                <DialogTitle>Confirm Delete</DialogTitle>\n                <DialogContent>\n                    Are you sure you want to delete this comment?\n                </DialogContent>\n                <DialogActions className=\"delete-dialog-actions\">\n                    <Button onClick={() => setIsDeleteCommentDialogOpen(false)} className=\"cancel-button\">Cancel</Button>\n                    <Button onClick={confirmDeleteComment} className=\"delete-button\">Delete</Button>\n                </DialogActions>\n            </Dialog>\n        </div>\n    );\n};\n\nexport default SUHome;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}